<!doctype html>
<html lang="en" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Chat</title>
  <style>
    /* ---------- Theme tokens ---------- */
    :root {
      --bg: #f6f7fb;
      --panel: #ffffff;
      --text: #0b1220;
      --muted: #667085;
      --line: #e6e8ee;
      --me-bg: #e8f1ff;
      --me-text: #0b1220;
      --you-bg: #ffffff;
      --you-text: #0b1220;
      --accent: #1f6feb;
      --accent-foreground: #ffffff;
      --input-bg: #ffffff;
    }
    @media (prefers-color-scheme: dark) {
      html[data-theme="auto"] {
        --bg: #0b0f16;
        --panel: #0f1521;
        --text: #eef2f6;
        --muted: #97a3b6;
        --line: #1b2637;
        --me-bg: #173257;
        --me-text: #dbe7ff;
        --you-bg: #111927;
        --you-text: #e6edf5;
        --accent: #3b82f6;
        --accent-foreground: #ffffff;
        --input-bg: #0f1521;
      }
    }
    html[data-theme="light"] {
      --bg: #f6f7fb;
      --panel: #ffffff;
      --text: #0b1220;
      --muted: #667085;
      --line: #e6e8ee;
      --me-bg: #e8f1ff;
      --me-text: #0b1220;
      --you-bg: #ffffff;
      --you-text: #0b1220;
      --accent: #1f6feb;
      --accent-foreground: #ffffff;
      --input-bg: #ffffff;
    }
    html[data-theme="dark"] {
      --bg: #0b0f16;
      --panel: #0f1521;
      --text: #eef2f6;
      --muted: #97a3b6;
      --line: #1b2637;
      --me-bg: #173257;
      --me-text: #dbe7ff;
      --you-bg: #111927;
      --you-text: #e6edf5;
      --accent: #3b82f6;
      --accent-foreground: #ffffff;
      --input-bg: #0f1521;
    }

    /* ---------- Layout ---------- */
    * { box-sizing: border-box }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
      background: var(--bg);
      color: var(--text);
    }
    header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--panel);
      border-bottom: 1px solid var(--line);
      padding: 10px 12px;
    }
    .bar {
      max-width: 840px;
      margin: 0 auto;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .dot { width: 10px; height: 10px; border-radius: 999px; background: #aaa }
    .dot.live { background: #22c55e }
    .title { font-weight: 700 }
    .room { color: var(--muted) }
    .spacer { flex: 1 }
    .theme {
      display: inline-flex;
      gap: 6px;
      align-items: center;
      border: 1px solid var(--line);
      background: var(--panel);
      padding: 6px 10px;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      font-size: 14px;
      color: var(--muted);
    }

    main {
      max-width: 840px;
      margin: 0 auto;
      padding: 12px 12px calc(88px + env(safe-area-inset-bottom));
    }
    #log { display: flex; flex-direction: column; gap: 12px }
    .msg { display: grid; gap: 6px; max-width: 80% }
    .msg.you { justify-self: start }
    .bubble {
      padding: 12px 14px;
      border: 1px solid var(--line);
      border-radius: 14px;
      background: var(--you-bg);
      color: var(--you-text);
      word-wrap: break-word;
      white-space: pre-wrap;
      line-height: 1.35;
    }
    .meta { font-size: 12px; color: var(--muted) }
    .msg.me { justify-self: end; }
    .msg.me .bubble {
      background: var(--me-bg);
      color: var(--me-text);
    }

    /* Composer like ChatGPT */
    form#composer {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(180deg, transparent, var(--bg) 20%);
      padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
      border-top: 1px solid var(--line);
    }
    .composer-row {
      max-width: 840px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 160px 1fr auto;
      gap: 8px;
    }
    input, textarea, button {
      font: inherit;
      border-radius: 12px;
      border: 1px solid var(--line);
    }
    input#author {
      padding: 10px 12px;
      background: var(--input-bg);
      color: var(--text);
    }
    textarea#content {
      padding: 12px 14px;
      background: var(--input-bg);
      color: var(--text);
      min-height: 44px;
      max-height: 180px;
      resize: none;
      overflow: auto;
    }
    button#sendBtn {
      padding: 0 16px;
      background: var(--accent);
      color: var(--accent-foreground);
      border: 1px solid var(--accent);
      min-width: 84px;
      height: 44px;
      cursor: pointer;
    }
    button#sendBtn:disabled { opacity: .65; cursor: not-allowed }

    @media (max-width: 520px) {
      .composer-row { grid-template-columns: 1fr auto }
      input#author { display: none }
    }
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="dot" id="statusDot"></div>
      <div class="title">Chat</div>
      <div class="room" id="roomLabel"></div>
      <div class="spacer"></div>
      <div id="themeToggle" class="theme" title="Toggle theme">Theme</div>
    </div>
  </header>

  <main>
    <div id="log" aria-live="polite"></div>
  </main>

  <form id="composer" autocomplete="off">
    <div class="composer-row">
      <input id="author" placeholder="Your name" />
      <textarea id="content" placeholder="Write a message"></textarea>
      <button id="sendBtn" type="submit">Send</button>
    </div>
  </form>

  <script type="module" src="./supabase-config.js"></script>
  <script type="module" src="./main.js"></script>
  <script src="https://esm.sh/@supabase/supabase-js@2"></script>
</body>
</html>