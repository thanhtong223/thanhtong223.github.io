<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Asteroids â€” Starfield</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #05070a;
      color: #e6edf3;
      font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif;
    }
    .hud {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, .5);
      padding: 10px 12px;
      border-radius: 8px;
      font-size: 14px;
      max-width: 520px;
      z-index: 10;
    }
    .hud .help { margin-top: 6px; opacity: .85; }
    #game {
      display: block;
      margin: 0 auto;
      background: #0d1117;
      border: 1px solid #1f2630;
    }
  </style>
</head>
<body>
  <div class="hud">
    <div><b>Mode</b>: Single Player</div>
    <div><b>Score</b>: <span id="score">0</span></div>
    <div class="help">WASD / Arrows to move â€¢ Aim with mouse â€¢ Auto-fire â€¢ Crash = 7s respawn â€¢ Press R to restart</div>
  </div>
  <canvas id="game" width="960" height="600"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const W = canvas.width, H = canvas.height;
    const $score = document.getElementById("score");
    const now = () => performance.now() / 1000;

    const SHIP_R = 12;
    const ROCK_MIN = 18, ROCK_MAX = 38, ROCK_SPEED = 40;
    const BULLET_SPEED = 360, SHOT_PERIOD = 0.14;
    const THRUST = 180, STRAFE = 0.6, BRAKE = 0.985, FRICTION = 0.99, RESPAWN_SECS = 7;

    const state = {
      score: 0,
      player: { x: W/2, y: H/2, rot: 0, vx: 0, vy: 0, alive: true, respawnAt: 0, color: "#9ecbff", bullets: [], lastShot: 0, thrusting:false, strafe:false },
      rocks: [], keys: {}, mouse: { x: W/2, y: H/2 }
    };

    const clamp = (v,min,max)=>v<min?min:(v>max?max:v);
    const rand = (a,b)=>Math.random()*(b-a)+a;

    // ðŸŒ  Starfield setup
    const stars = Array.from({length:120}, () => ({
      x: Math.random()*W,
      y: Math.random()*H,
      r: Math.random()*1.3 + 0.2,
      s: Math.random()*0.5 + 0.2,
      tw: Math.random()*Math.PI*2
    }));

    function drawStars(dt) {
      ctx.save();
      ctx.fillStyle = "#05070a";
      ctx.fillRect(0, 0, W, H);
      for (const st of stars) {
        st.x += st.s * 5 * dt;
        if (st.x > W) st.x = 0;
        st.tw += dt;
        const alpha = 0.2 + 0.15 * Math.sin(st.tw);
        ctx.beginPath();
        ctx.fillStyle = `rgba(255,255,255,${alpha})`;
        ctx.arc(st.x, st.y, st.r, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.restore();
    }

    // Spawn meteoroids from outside edges
    function spawnRock(){
      const side = Math.floor(Math.random() * 4);
      let x, y, angle;
      if (side === 0) { x = rand(-50, 0); y = rand(0, H); angle = rand(-Math.PI/4, Math.PI/4); }
      if (side === 1) { x = rand(W, W+50); y = rand(0, H); angle = Math.PI + rand(-Math.PI/4, Math.PI/4); }
      if (side === 2) { x = rand(0, W); y = rand(-50, 0); angle = rand(Math.PI/2 - 0.4, Math.PI/2 + 0.4); }
      if (side === 3) { x = rand(0, W); y = rand(H, H+50); angle = -Math.PI/2 + rand(-0.4, 0.4); }
      const speed = rand(ROCK_SPEED*0.6, ROCK_SPEED*1.3);
      return { x, y, vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed, r: rand(ROCK_MIN, ROCK_MAX) };
    }

    function spawnRocks(n=8){ state.rocks=[]; for(let i=0;i<n;i++) state.rocks.push(spawnRock()); }

    function resetGame(){
      state.score=0;$score.textContent="0";
      const p=state.player;
      Object.assign(p,{x:W/2,y:H/2,vx:0,vy:0,alive:true,respawnAt:0,bullets:[],lastShot:0});
      spawnRocks(8);
    }

    function drawShip(p,alpha=1){
      ctx.save();ctx.globalAlpha=alpha;ctx.translate(p.x,p.y);ctx.rotate(p.rot);
      ctx.strokeStyle=p.color;ctx.lineWidth=2;
      ctx.beginPath();ctx.moveTo(14,0);ctx.lineTo(-10,-8);ctx.lineTo(-6,0);ctx.lineTo(-10,8);ctx.closePath();ctx.stroke();

      // Engine burst flames
      if(p.thrusting){
        ctx.strokeStyle="orange";
        ctx.beginPath();ctx.moveTo(-10,0);
        ctx.lineTo(-18+Math.random()*-4,0);
        ctx.stroke();
      }
      if(p.strafe){
        ctx.strokeStyle="deepskyblue";
        ctx.beginPath();
        ctx.moveTo(0,-8);ctx.lineTo(0,-12-Math.random()*2);
        ctx.moveTo(0,8);ctx.lineTo(0,12+Math.random()*2);
        ctx.stroke();
      }
      ctx.restore();ctx.globalAlpha=1;
    }

    function drawBullet(b){ctx.fillStyle="#fff";ctx.beginPath();ctx.arc(b.x,b.y,2,0,Math.PI*2);ctx.fill();}
    function drawRock(r){ctx.strokeStyle="#aaa";ctx.beginPath();ctx.arc(r.x,r.y,r.r,0,Math.PI*2);ctx.stroke();}

    function updatePlayer(dt){
      const p=state.player;if(!p.alive)return;
      p.rot=Math.atan2(state.mouse.y-p.y,state.mouse.x-p.x);
      const fwdX=Math.cos(p.rot),fwdY=Math.sin(p.rot);
      const rightX=Math.cos(p.rot+Math.PI/2),rightY=Math.sin(p.rot+Math.PI/2);
      p.thrusting=false;p.strafe=false;

      if(state.keys["w"]||state.keys["arrowup"]){p.vx+=fwdX*THRUST*dt;p.vy+=fwdY*THRUST*dt;p.thrusting=true;}
      if(state.keys["s"]||state.keys["arrowdown"]){p.vx*=BRAKE;p.vy*=BRAKE;}
      if(state.keys["a"]||state.keys["arrowleft"]){p.vx+=rightX*-THRUST*STRAFE*dt;p.vy+=rightY*-THRUST*STRAFE*dt;p.strafe=true;}
      if(state.keys["d"]||state.keys["arrowright"]){p.vx+=rightX*THRUST*STRAFE*dt;p.vy+=rightY*THRUST*STRAFE*dt;p.strafe=true;}

      p.vx*=FRICTION;p.vy*=FRICTION;
      let nx=p.x+p.vx*dt,ny=p.y+p.vy*dt;
      if(nx<SHIP_R){nx=SHIP_R;p.vx=0;}
      if(nx>W-SHIP_R){nx=W-SHIP_R;p.vx=0;}
      if(ny<SHIP_R){ny=SHIP_R;p.vy=0;}
      if(ny>H-SHIP_R){ny=H-SHIP_R;p.vy=0;}
      p.x=nx;p.y=ny;

      // Autofire
      p.lastShot+=dt;
      if(p.lastShot>SHOT_PERIOD){
        p.lastShot=0;
        p.bullets.push({x:p.x+Math.cos(p.rot)*14,y:p.y+Math.sin(p.rot)*14,vx:Math.cos(p.rot)*BULLET_SPEED,vy:Math.sin(p.rot)*BULLET_SPEED,t:0});
      }
    }

    function updateBullets(dt){
      const p=state.player;
      p.bullets=p.bullets.filter(b=>{
        b.x+=b.vx*dt;b.y+=b.vy*dt;b.t+=dt;
        return !(b.t>=2.5||b.x<0||b.x>W||b.y<0||b.y>H);
      });
    }

    function updateRocks(dt){
      for(const r of state.rocks){
        r.x+=r.vx*dt;r.y+=r.vy*dt;
        if(r.x<-80||r.x>W+80||r.y<-80||r.y>H+80){
          Object.assign(r, spawnRock());
        }
      }
    }

    function collisions(){
      const p=state.player;
      if(p.alive){
        for(const b of p.bullets){
          for(const r of state.rocks){
            const dx=b.x-r.x,dy=b.y-r.y;
            if(dx*dx+dy*dy<r.r*r.r){
              b.t=999;r.r*=0.66;
              state.score+=10;$score.textContent=String(state.score);
              if(r.r<12){Object.assign(r,spawnRock());}
            }
          }
        }
        for(const r of state.rocks){
          const dx=p.x-r.x,dy=p.y-r.y,rr=r.r+SHIP_R;
          if(dx*dx+dy*dy<rr*rr){p.alive=false;p.respawnAt=now()+RESPAWN_SECS;p.bullets=[];break;}
        }
      }else if(now()>=p.respawnAt){p.alive=true;p.x=rand(100,W-100);p.y=rand(100,H-100);p.vx=p.vy=0;p.bullets=[];}
    }

    function loop(ts){
      if(!loop.last)loop.last=ts;
      const dt=Math.min(0.05,(ts-loop.last)/1000);loop.last=ts;
      drawStars(dt);
      updatePlayer(dt);updateBullets(dt);updateRocks(dt);collisions();
      for(const r of state.rocks)drawRock(r);
      const p=state.player;
      if(p.alive){drawShip(p,1);for(const b of p.bullets)drawBullet(b);}
      else{const s=Math.max(0,Math.ceil(p.respawnAt-now()));drawShip(p,0.25);ctx.fillStyle="#9ecbff";ctx.font="12px system-ui";ctx.fillText(`respawn ${s}s`,p.x+14,p.y-14);}
      requestAnimationFrame(loop);
    }

    function setupInput(){
      addEventListener("keydown",e=>{const k=e.key.toLowerCase();state.keys[k]=true;if(k==="r")resetGame();});
      addEventListener("keyup",e=>{const k=e.key.toLowerCase();state.keys[k]=false;});
      canvas.addEventListener("mousemove",e=>{const r=canvas.getBoundingClientRect();state.mouse.x=clamp(e.clientX-r.left,0,W);state.mouse.y=clamp(e.clientY-r.top,0,H);});
    }

    function start(){setupInput();resetGame();requestAnimationFrame(loop);}
    start();
  </script>
</body>
</html>
