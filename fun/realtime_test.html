<!doctype html>
<html>
<head><meta charset="utf-8"><title>Supabase Realtime Test</title></head>
<body>
  <pre id="log">starting…</pre>
  <script type="module">
    const log = (...a)=>{ const el=document.getElementById('log'); el.textContent += "\n" + a.join(" "); console.log(...a); };

    // ✅ Try jsDelivr first (more reliable on Pages)
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/esm/index.js";

    const SUPABASE_URL = "https://YOUR-PROJECT.supabase.co"; // TODO
    const SUPABASE_ANON_KEY = "YOUR-ANON-KEY";               // TODO

    const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const myId = crypto.randomUUID();
    const room = "test-room";

    const ch = sb.channel(room, { config: { presence: { key: myId } } });

    ch.on("presence", { event: "sync" }, () => {
      const st = ch.presenceState?.() || {};
      log("presence sync; users:", Object.keys(st).length, JSON.stringify(st, null, 2));
    });

    ch.on("broadcast", { event: "ping" }, ({ payload }) => {
      log("recv broadcast:", JSON.stringify(payload));
    });

    await ch.subscribe((status) => log("subscribe status:", status));
    await ch.track({ joinedAt: Date.now(), test: true });
    log("tracked presence as", myId);

    // send a test broadcast every 5s
    setInterval(() => {
      ch.send({ type: "broadcast", event: "ping", payload: { from: myId, t: Date.now() } });
      log("sent broadcast ping");
    }, 5000);
  </script>
</body>
</html>
